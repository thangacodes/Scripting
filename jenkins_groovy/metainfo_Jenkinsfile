pipeline {
    agent any
        environment {
        S3_BUCKETNAME="s3://gitops-demo-bucket-tf/"
        FILE_NAME="meta_datainfo.txt"
    }
    stages {
        stage('Git_Checkout') { 
            steps { 
                sh 'git clone https://github.com/thangacodes/shell-scripting.git'
                sh '''
                   pwd
                   cd shell-scripting/awscli_scripts/
                   pwd
                  ls -lrt
                '''
            }
        }
        stage('task_execution') {
            steps {
                sh '''
                   cd shell-scripting/awscli_scripts/
                   chmod +x finding_instance_metainfo.sh
                   sh finding_instance_metainfo.sh
                '''
            }
        }
        stage('files_list') { 
            steps { 
                sh '''
                    aws s3 ls ${S3_BUCKETNAME}
                    ls -lrth
                '''
                }
        }
        stage('USER INPUT'){
		    steps{
			    input 'Do you want to delete the file? If yes, please select Proceed or Abort?'
			}
		}
        stage('FILE_DELETION'){
          steps{
            sh '''
            aws s3 rm $S3_BUCKET_NAME/$FILE_NAME
            sleep 5
            echo "Post deletion, checking once again if the file is deleted or not.."
            aws s3 ls $S3_BUCKET_NAME
            '''
		}
	}
    }
    post {
        always {
            cleanWs()
        }
    }
}
